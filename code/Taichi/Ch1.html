<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>太极的基础 | 独自赏晴雨</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    <meta name="description" content="独自赏晴雨的学习笔记">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/docs/assets/css/0.styles.9fb96153.css" as="style"><link rel="preload" href="/docs/assets/js/app.eb0cdd49.js" as="script"><link rel="preload" href="/docs/assets/js/3.876e492f.js" as="script"><link rel="preload" href="/docs/assets/js/1.acc679c2.js" as="script"><link rel="preload" href="/docs/assets/js/20.87a29a2e.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.44af3a08.js"><link rel="prefetch" href="/docs/assets/js/11.e560f46e.js"><link rel="prefetch" href="/docs/assets/js/12.6c235a51.js"><link rel="prefetch" href="/docs/assets/js/13.50f51d91.js"><link rel="prefetch" href="/docs/assets/js/14.9e7878f3.js"><link rel="prefetch" href="/docs/assets/js/15.9e9f23f3.js"><link rel="prefetch" href="/docs/assets/js/16.f09f2147.js"><link rel="prefetch" href="/docs/assets/js/17.a47a2184.js"><link rel="prefetch" href="/docs/assets/js/18.9908eba2.js"><link rel="prefetch" href="/docs/assets/js/19.c6c1c06c.js"><link rel="prefetch" href="/docs/assets/js/21.25cae25e.js"><link rel="prefetch" href="/docs/assets/js/22.b180fc61.js"><link rel="prefetch" href="/docs/assets/js/23.e319f295.js"><link rel="prefetch" href="/docs/assets/js/24.a270f98a.js"><link rel="prefetch" href="/docs/assets/js/25.d1dbe222.js"><link rel="prefetch" href="/docs/assets/js/26.a95a2cc0.js"><link rel="prefetch" href="/docs/assets/js/27.8b80267b.js"><link rel="prefetch" href="/docs/assets/js/28.5b02bb6e.js"><link rel="prefetch" href="/docs/assets/js/29.2d6c6cdb.js"><link rel="prefetch" href="/docs/assets/js/30.91e02b18.js"><link rel="prefetch" href="/docs/assets/js/31.8288055e.js"><link rel="prefetch" href="/docs/assets/js/32.80a8a029.js"><link rel="prefetch" href="/docs/assets/js/33.ace78620.js"><link rel="prefetch" href="/docs/assets/js/34.392b9a2b.js"><link rel="prefetch" href="/docs/assets/js/35.2b14eeab.js"><link rel="prefetch" href="/docs/assets/js/36.a7e081cb.js"><link rel="prefetch" href="/docs/assets/js/37.fbb0416f.js"><link rel="prefetch" href="/docs/assets/js/38.355ef476.js"><link rel="prefetch" href="/docs/assets/js/39.2c86281c.js"><link rel="prefetch" href="/docs/assets/js/4.67e16cf9.js"><link rel="prefetch" href="/docs/assets/js/40.c9fd1f48.js"><link rel="prefetch" href="/docs/assets/js/41.cce4ae7d.js"><link rel="prefetch" href="/docs/assets/js/42.9e94c47e.js"><link rel="prefetch" href="/docs/assets/js/5.2dfb5fe4.js"><link rel="prefetch" href="/docs/assets/js/6.aae26cdb.js"><link rel="prefetch" href="/docs/assets/js/7.d0f791c9.js"><link rel="prefetch" href="/docs/assets/js/8.d743ea4f.js"><link rel="prefetch" href="/docs/assets/js/9.57b04940.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.9fb96153.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>独自赏晴雨</h3> <p class="description" data-v-59e6cb88>独自赏晴雨的学习笔记</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="logo.png" alt="独自赏晴雨" class="logo"> <span class="site-name">独自赏晴雨</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/categories/课程笔记/" class="nav-link"><i class="undefined"></i>
  课程笔记
</a></li><li class="dropdown-item"><!----> <a href="/docs/categories/文献阅读/" class="nav-link"><i class="undefined"></i>
  文献阅读
</a></li></ul></div></div><div class="nav-item"><a href="/docs/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      机器学习
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/AI/graph/" class="nav-link"><i class="undefined"></i>
  图机器学习
</a></li><li class="dropdown-item"><!----> <a href="/docs/AI/deep/" class="nav-link"><i class="undefined"></i>
  深度无监督学习
</a></li><li class="dropdown-item"><!----> <a href="/docs/AI/RL/" class="nav-link"><i class="undefined"></i>
  强化学习
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      编程语言
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/code/Taichi/" class="nav-link router-link-active"><i class="undefined"></i>
  Taichi
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      数学
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/math/set/" class="nav-link"><i class="undefined"></i>
  集合论与图论
</a></li><li class="dropdown-item"><!----> <a href="/docs/math/num/" class="nav-link"><i class="undefined"></i>
  数值分析
</a></li><li class="dropdown-item"><!----> <a href="/docs/math/mat/" class="nav-link"><i class="undefined"></i>
  矩阵论
</a></li></ul></div></div><div class="nav-item"><a href="/docs/paper/" class="nav-link"><i class="undefined"></i>
  论文阅读
</a></div><div class="nav-item"><a href="/docs/play/" class="nav-link"><i class="undefined"></i>
  项目
</a></div><div class="nav-item"><a href="/docs/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      社交账号
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/HFC666" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.zhihu.com/people/bu-yu-que-zhi-xin-43-35/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-zhihu"></i>
  知乎
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="logo.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <!----> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>32</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>15</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/categories/课程笔记/" class="nav-link"><i class="undefined"></i>
  课程笔记
</a></li><li class="dropdown-item"><!----> <a href="/docs/categories/文献阅读/" class="nav-link"><i class="undefined"></i>
  文献阅读
</a></li></ul></div></div><div class="nav-item"><a href="/docs/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      机器学习
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/AI/graph/" class="nav-link"><i class="undefined"></i>
  图机器学习
</a></li><li class="dropdown-item"><!----> <a href="/docs/AI/deep/" class="nav-link"><i class="undefined"></i>
  深度无监督学习
</a></li><li class="dropdown-item"><!----> <a href="/docs/AI/RL/" class="nav-link"><i class="undefined"></i>
  强化学习
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      编程语言
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/code/Taichi/" class="nav-link router-link-active"><i class="undefined"></i>
  Taichi
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      数学
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/math/set/" class="nav-link"><i class="undefined"></i>
  集合论与图论
</a></li><li class="dropdown-item"><!----> <a href="/docs/math/num/" class="nav-link"><i class="undefined"></i>
  数值分析
</a></li><li class="dropdown-item"><!----> <a href="/docs/math/mat/" class="nav-link"><i class="undefined"></i>
  矩阵论
</a></li></ul></div></div><div class="nav-item"><a href="/docs/paper/" class="nav-link"><i class="undefined"></i>
  论文阅读
</a></div><div class="nav-item"><a href="/docs/play/" class="nav-link"><i class="undefined"></i>
  项目
</a></div><div class="nav-item"><a href="/docs/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      社交账号
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/HFC666" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.zhihu.com/people/bu-yu-que-zhi-xin-43-35/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-zhihu"></i>
  知乎
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><a href="/docs/code/Taichi/" aria-current="page" class="sidebar-link">Taichi</a></li><li><a href="/docs/code/Taichi/Ch1.html" aria-current="page" class="active sidebar-link">太极的基础</a></li><li><a href="/docs/code/Taichi/Ch2.html" class="sidebar-link">元编程和面向对象编程</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>太极的基础</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">太极的基础</h1> <div data-v-8a445198><!----> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>1/7/2023</span></i> <i class="iconfont reco-eye" data-v-8a445198><span id="/docs/code/Taichi/Ch1.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-8a445198><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>编程语言</span><span class="tag-item" data-v-8a445198>计算机图形学</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="太极的基础"><a href="#太极的基础" class="header-anchor">#</a> 太极的基础</h2> <h3 id="太极的数据"><a href="#太极的数据" class="header-anchor">#</a> 太极的数据</h3> <p>基础类型(Primitive types)：</p> <ul><li>有符号整型：ti.i8，ti.i16，ti.i32(默认)，ti.i64</li> <li>无符号整型：ti.u8，ti.u16，ti.u32，ti.u64</li> <li>浮点型：ti.f32(默认)，ti.f64</li></ul> <p>我们也可以对默认数据类型进行改变：</p> <div class="language-python extra-class"><pre class="language-python"><code>ti<span class="token punctuation">.</span>init<span class="token punctuation">(</span>default_fp<span class="token operator">=</span>ti<span class="token punctuation">.</span>f32<span class="token punctuation">)</span>  
ti<span class="token punctuation">.</span>init<span class="token punctuation">(</span>default_fp<span class="token operator">=</span>ti<span class="token punctuation">.</span>f64<span class="token punctuation">)</span>

ti<span class="token punctuation">.</span>init<span class="token punctuation">(</span>default_ip<span class="token operator">=</span>ti<span class="token punctuation">.</span>i32<span class="token punctuation">)</span>
ti<span class="token punctuation">.</span>init<span class="token punctuation">(</span>default_ip<span class="token operator">=</span>ti<span class="token punctuation">.</span>i64<span class="token punctuation">)</span>
</code></pre></div><h4 id="类型提升"><a href="#类型提升" class="header-anchor">#</a> 类型提升</h4> <ul><li>i32 + f32 = f32</li> <li>i32 + i64 = i64</li></ul> <h4 id="类型转换"><a href="#类型转换" class="header-anchor">#</a> 类型转换</h4> <p><code>Taichi</code>类型隐式转换，且为静态类型：</p> <p>在<code>Python</code>中</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> taichi <span class="token keyword">as</span> ti

ti<span class="token punctuation">.</span>init<span class="token punctuation">(</span>arch<span class="token operator">=</span>ti<span class="token punctuation">.</span>cpu<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    a <span class="token operator">=</span> <span class="token number">1</span>
    a <span class="token operator">=</span> <span class="token number">2.7</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
foo<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#2.7</span>
</code></pre></div><p>在<code>Taichi</code>中</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> taichi <span class="token keyword">as</span> ti

ti<span class="token punctuation">.</span>init<span class="token punctuation">(</span>arch<span class="token operator">=</span>ti<span class="token punctuation">.</span>cpu<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@ti<span class="token punctuation">.</span>kernel</span>
<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    a <span class="token operator">=</span> <span class="token number">1</span>
    a <span class="token operator">=</span> <span class="token number">2.7</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
foo<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#2</span>
</code></pre></div><p>也可以进行显式转换：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> taichi <span class="token keyword">as</span> ti

ti<span class="token punctuation">.</span>init<span class="token punctuation">(</span>arch<span class="token operator">=</span>ti<span class="token punctuation">.</span>cpu<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@ti<span class="token punctuation">.</span>kernel</span>
<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    a <span class="token operator">=</span> <span class="token number">1.7</span>
    b <span class="token operator">=</span> ti<span class="token punctuation">.</span>cast<span class="token punctuation">(</span>a<span class="token punctuation">,</span> ti<span class="token punctuation">.</span>i32<span class="token punctuation">)</span>
    c <span class="token operator">=</span> ti<span class="token punctuation">.</span>cast<span class="token punctuation">(</span>b<span class="token punctuation">,</span> ti<span class="token punctuation">.</span>f32<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;b=&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>  <span class="token comment"># b = 1</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;c=&quot;</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>  <span class="token comment"># c = 1.0</span>
foo<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="compound-types"><a href="#compound-types" class="header-anchor">#</a> Compound types</h4> <div class="language-python extra-class"><pre class="language-python"><code>ti<span class="token punctuation">.</span>init<span class="token punctuation">(</span>arch<span class="token operator">=</span>ti<span class="token punctuation">.</span>cpu<span class="token punctuation">)</span>

vec3f <span class="token operator">=</span> ti<span class="token punctuation">.</span>types<span class="token punctuation">.</span>vector<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> ti<span class="token punctuation">.</span>f32<span class="token punctuation">)</span>  <span class="token comment"># 定义元素为3个，类型为ti.f32的向量</span>
mat2f <span class="token operator">=</span> ti<span class="token punctuation">.</span>types<span class="token punctuation">.</span>matrix<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> ti<span class="token punctuation">.</span>f32<span class="token punctuation">)</span>  <span class="token comment"># 定义2x2的矩阵</span>
ray <span class="token operator">=</span> ti<span class="token punctuation">.</span>types<span class="token punctuation">.</span>struct<span class="token punctuation">(</span>ro<span class="token operator">=</span>vec3f<span class="token punctuation">,</span> rd <span class="token operator">=</span> vec3f<span class="token punctuation">,</span> l<span class="token operator">=</span>ti<span class="token punctuation">.</span>f32<span class="token punctuation">)</span>
</code></pre></div><p>因为<code>taichi</code>中向量和矩阵用的比较多，所以已经预定义了一些数据类型：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@ti<span class="token punctuation">.</span>kernel</span>
<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    a <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>      <span class="token comment"># [0.0, 0.0, 0.0]</span>
    d <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>      <span class="token comment"># [0.0, 1.0, 0.0]</span>
    B <span class="token operator">=</span> ti<span class="token punctuation">.</span>Matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">1.4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;B=&quot;</span><span class="token punctuation">,</span> B<span class="token punctuation">)</span>  <span class="token comment"># B = [[1.5, 1.4], [1.3, 1.2]]</span>
    r <span class="token operator">=</span> ti<span class="token punctuation">.</span>Struct<span class="token punctuation">(</span>v1<span class="token operator">=</span>a<span class="token punctuation">,</span> v2<span class="token operator">=</span>d<span class="token punctuation">,</span> l<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;r.v1=&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>v1<span class="token punctuation">)</span>    <span class="token comment"># r.v1 = [0.0, 0.0, 0.0]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;r.v2=&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>v2<span class="token punctuation">)</span>    <span class="token comment"># r.v2 = [0.0, 1.0, 0.0]</span>
foo<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="ti-field"><a href="#ti-field" class="header-anchor">#</a> <code>ti.field</code></h4> <ul><li>一个<strong>全局</strong>的元素的<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span>维数组
<ul><li>全局：可以在<code>Taichi-scope</code>中被调用，也可以在Python-scope中被调用</li> <li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span>维：常数(0维)，向量(1维)，矩阵(2维)，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi><mo>=</mo><mn>3</mn><mo separator="true">,</mo><mn>4</mn><mo separator="true">,</mo><mo>⋯</mo></mrow><annotation encoding="application/x-tex">N=3,4,\cdots</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mrel">=</span><span class="mord mathrm">3</span><span class="mpunct">,</span><span class="mord mathrm">4</span><span class="mpunct">,</span><span class="minner">⋯</span></span></span></span></li> <li>元素：常数、向量、矩阵、结构体</li> <li>也可以采用[i,j,k]这样的方式对元素进行索引</li></ul></li></ul> <div class="language-python extra-class"><pre class="language-python"><code>pixels <span class="token operator">=</span> ti<span class="token punctuation">.</span>field<span class="token punctuation">(</span>dtype<span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pixels<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">42.0</span>

vf <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">.</span>field<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> ti<span class="token punctuation">.</span>f32<span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>  <span class="token comment"># 这个field的元素数量为4，每个元素为元素数目为3的向量</span>

<span class="token decorator annotation punctuation">@ti<span class="token punctuation">.</span>kernel</span>
<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    v <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    vf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> v
</code></pre></div><p>特殊情况，使用None来索引一个<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">0</span></span></span></span>维域</p> <div class="language-python extra-class"><pre class="language-python"><code>zero_d_scalar <span class="token operator">=</span> ti<span class="token punctuation">.</span>field<span class="token punctuation">(</span>ti<span class="token punctuation">.</span>f32<span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
zero_d_scalar<span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.5</span>

zero_d_vec <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">.</span>field<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> ti<span class="token punctuation">.</span>f32<span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
zero_d_vec<span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">2.6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="太极的计算核"><a href="#太极的计算核" class="header-anchor">#</a> 太极的计算核</h3> <h4 id="ti-kernel"><a href="#ti-kernel" class="header-anchor">#</a> <code>ti.kernel</code></h4> <p>通过<code>@ti.kernel</code>来声明一个Python函数，<code>Taichi</code>核只能被Python scope调用：</p> <p><img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC1.png" alt=""></p> <blockquote><ul><li>第一种情况：用<code>@ti.kernel</code>定义的函数可以在Python-scope中调用</li> <li>第二种情况：用<code>@ti.kernel</code>定义的函数可以被Python定义的函数调用</li> <li>第三种情况：用<code>@ti.kernel</code>定义的函数不可以被<code>@ti.kernel</code>定义的函数调用</li></ul></blockquote> <p>在<code>Taichi kernel</code>中最外层的循环将被自动并行化：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@ti<span class="token punctuation">.</span>kernel</span>
<span class="token keyword">def</span> <span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># Parallelized</span>
        x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> i
        s <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># 在每个并行化中串行</span>
            s <span class="token operator">+=</span> j
        y<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> s
    <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token comment"># Parallelized</span>
        z<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> k
</code></pre></div><p><img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC2.png" alt=""></p> <blockquote><p>在上面的图片中，第一种情况会被并行化，而第二种情况因为外面有<code>if</code>，所以不会被并行化</p></blockquote> <p>因此我们需要定义我们循环使其有更好的表现：</p> <p><img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC3.png" alt=""></p> <blockquote><p>改善我们的程序</p></blockquote> <p><code>break</code>在我们的并行<code>for</code>中是不支持的：</p> <p><img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC4.png" alt=""></p> <p>因为我们最外层的<code>for</code>是并行的，所以我们需要对其进行保护，<code>Taichi</code>使用<code>+=</code>来进行<code>atomic add</code>来保护我们的数据。</p> <p><img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC5.png" alt=""></p> <blockquote><p>第三种情况无法对我们的数据进行保护。</p></blockquote> <p><code>Taichi</code>中的<code>for</code>可以分为两种：</p> <ul><li><code>range-for</code>：与<code>Python</code>中相同的<code>range</code></li> <li><code>struct-for</code>：在<code>ti.field</code>上的for，只在最外层可以使用</li></ul> <p><img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC6.png" alt=""></p> <p>kernel的参数：</p> <ul><li>最多<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn></mrow><annotation encoding="application/x-tex">8</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">8</span></span></span></span>个参数</li> <li>从Python-scope传到<code>Taichi-scope</code></li> <li>必须声明类型：因为Python是弱类型的，从Python传入必须声明数据类型<img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC7.png" alt=""></li> <li>只能支持Scalars：<code>ti.Matirx</code>，<code>ti.Vector</code>，<code>ti.types.ndarray()</code>，<code>ti.template()</code><img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC8.png" alt=""></li> <li>值传递：<img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC9.png" alt=""></li></ul> <p><code>@ti.kernel</code>的返回值</p> <ul><li>可以返回也可以不返回</li> <li>只能返回单一的scalar</li> <li>必须声明类型</li></ul> <p><img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC10.png" alt=""></p> <h4 id="ti-func"><a href="#ti-func" class="header-anchor">#</a> <code>ti.func</code></h4> <p>通过<code>@ti.func</code>修饰：只能在<code>Taichi-scope</code>中被调用</p> <p><img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC11.png" alt=""></p> <ul><li>函数可以嵌套调用</li> <li>函数是强制内联的(不能递归)</li></ul> <p><img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC12.png" alt=""></p> <p>函数的参数和返回值：</p> <ul><li>不许要实现声明类型，因为我们的参数和返回值都会在<code>@ti.kernel</code>中处理<img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC13.png" alt=""></li> <li>同样是值传递<img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC14.png" alt=""></li></ul> <p>任何在<code>@ti.kernel</code>和<code>@ti.func</code>的东西都是静态数据类型：</p> <p><img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC15.png" alt=""></p> <p>静态的词法作用域：</p> <p><img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC16.png" alt=""></p> <blockquote><p>在这里y的词法作用域仅在if中，出了词法作用域就会报错。</p></blockquote> <ul><li><code>@ti.kernels</code>和<code>@ti.func</code>将会被编译成JIT</li> <li><code>Taichi scope</code>变量在运行期间无法看到<code>Python-scope</code>变量的变化</li></ul> <p><img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC17.png" alt=""></p> <blockquote><p>在左面的程序中，我们的<code>@ti.kernel</code>被编译成JIT后<code>a</code>就编译成常量了，在Python-scope中变化并不会被察觉。为了被察觉，可以将其定义为<code>ti.field</code>。</p></blockquote> <h4 id="math"><a href="#math" class="header-anchor">#</a> Math</h4> <p><img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC18.png" alt=""></p> <h3 id="可视化你的太极程序"><a href="#可视化你的太极程序" class="header-anchor">#</a> 可视化你的太极程序</h3> <h4 id="print"><a href="#print" class="header-anchor">#</a> Print</h4> <p>与<code>Python</code>的<code>Print</code>大致相同：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">print</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
</code></pre></div><p>可以支持字符串、scalar、vector、matrix</p> <p>几乎在所有位置都可以运行。</p> <p>在GPU运行的最外层<code>for</code>内顺序可能是随机的，因为并行化：
<img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC19.png" alt=""></p> <p>在GPU上运行的<code>print()</code>可能会在看到<code>ti.sync()</code>后被打印出来：</p> <p><img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC20.png" alt=""></p> <h4 id="gui"><a href="#gui" class="header-anchor">#</a> GUI</h4> <p><img src="https://raw.githubusercontent.com/HFC666/image/master/img/TC21.png" alt=""></p> <h3 id="例子"><a href="#例子" class="header-anchor">#</a> 例子</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> taichi <span class="token keyword">as</span> ti

ti<span class="token punctuation">.</span>init<span class="token punctuation">(</span>ti<span class="token punctuation">.</span>gpu<span class="token punctuation">)</span>

<span class="token comment"># global control</span>
paused <span class="token operator">=</span> ti<span class="token punctuation">.</span>field<span class="token punctuation">(</span>ti<span class="token punctuation">.</span>i32<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 重力常数 6.67408e-11，为了简便使用1</span>
G <span class="token operator">=</span> <span class="token number">1</span>
PI <span class="token operator">=</span> <span class="token number">3.141592653</span>

<span class="token comment"># 行星的数量</span>
N <span class="token operator">=</span> <span class="token number">1000</span>
<span class="token comment"># 单位重量</span>
m <span class="token operator">=</span> <span class="token number">5</span>
<span class="token comment"># 星系大小</span>
galaxy_size <span class="token operator">=</span> <span class="token number">0.4</span>
<span class="token comment"># 行星半径</span>
planet_radius <span class="token operator">=</span> <span class="token number">2</span>
<span class="token comment"># init vel 初始速度</span>
init_vel <span class="token operator">=</span> <span class="token number">120</span>

<span class="token comment"># time-step size</span>
h <span class="token operator">=</span> <span class="token number">1e-5</span>
<span class="token comment"># substepping</span>
substepping <span class="token operator">=</span> <span class="token number">10</span>

<span class="token comment"># 位置，速度和受力</span>
pos <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">.</span>field<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> ti<span class="token punctuation">.</span>f32<span class="token punctuation">,</span> N<span class="token punctuation">)</span>
vel <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">.</span>field<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> ti<span class="token punctuation">.</span>f32<span class="token punctuation">,</span> N<span class="token punctuation">)</span>
force <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">.</span>field<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> ti<span class="token punctuation">.</span>f32<span class="token punctuation">,</span> N<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@ti<span class="token punctuation">.</span>kernel</span>
<span class="token keyword">def</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    center <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
        theta <span class="token operator">=</span> ti<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> PI
        r <span class="token operator">=</span> <span class="token punctuation">(</span>ti<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>ti<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.7</span> <span class="token operator">+</span> <span class="token number">0.3</span><span class="token punctuation">)</span> <span class="token operator">*</span> galaxy_size
        offset <span class="token operator">=</span> r <span class="token operator">*</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">(</span><span class="token punctuation">[</span>ti<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>theta<span class="token punctuation">)</span><span class="token punctuation">,</span> ti<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>theta<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> center <span class="token operator">+</span> offset
        vel<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span>offset<span class="token punctuation">.</span>y<span class="token punctuation">,</span> offset<span class="token punctuation">.</span>x<span class="token punctuation">]</span>
        vel<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*=</span> init_vel

<span class="token decorator annotation punctuation">@ti<span class="token punctuation">.</span>kernel</span>
<span class="token keyword">def</span> <span class="token function">compute_force</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token comment"># 清除受力</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
        force<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> ti<span class="token punctuation">.</span>Vector<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 计算引力</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
            diff <span class="token operator">=</span> p <span class="token operator">-</span> pos<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
            r <span class="token operator">=</span> diff<span class="token punctuation">.</span>norm<span class="token punctuation">(</span><span class="token number">1e-5</span><span class="token punctuation">)</span>
            
            f <span class="token operator">=</span> <span class="token operator">-</span>G <span class="token operator">*</span>m <span class="token operator">*</span> m <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span><span class="token operator">/</span>r<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">3</span> <span class="token operator">*</span> diff
            force<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> f
            force<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token operator">-</span>f
<span class="token decorator annotation punctuation">@ti<span class="token punctuation">.</span>kernel</span>
<span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    dt <span class="token operator">=</span> h<span class="token operator">/</span>substepping
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
        vel<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> dt<span class="token operator">*</span>force<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">/</span>m
        pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> dt<span class="token operator">*</span>vel<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
gui <span class="token operator">=</span> ti<span class="token punctuation">.</span>GUI<span class="token punctuation">(</span><span class="token string">'N-body problem'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
initialize<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> gui<span class="token punctuation">.</span>running<span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>substepping<span class="token punctuation">)</span><span class="token punctuation">:</span>
        compute_force<span class="token punctuation">(</span><span class="token punctuation">)</span>
        update<span class="token punctuation">(</span><span class="token punctuation">)</span>
    gui<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token number">0x112F41</span><span class="token punctuation">)</span>
    gui<span class="token punctuation">.</span>circles<span class="token punctuation">(</span>pos<span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token number">0xffffff</span><span class="token punctuation">,</span> radius<span class="token operator">=</span>planet_radius<span class="token punctuation">)</span>
    gui<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/docs/code/Taichi/" class="prev router-link-active">
          Taichi
        </a></span> <span class="next"><a href="/docs/code/Taichi/Ch2.html">
          元编程和面向对象编程
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/docs/code/Taichi/Ch1.html#太极的基础" class="sidebar-link reco-side-太极的基础" data-v-b57cc07c>太极的基础</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/code/Taichi/Ch1.html#太极的数据" class="sidebar-link reco-side-太极的数据" data-v-b57cc07c>太极的数据</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/code/Taichi/Ch1.html#太极的计算核" class="sidebar-link reco-side-太极的计算核" data-v-b57cc07c>太极的计算核</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/code/Taichi/Ch1.html#可视化你的太极程序" class="sidebar-link reco-side-可视化你的太极程序" data-v-b57cc07c>可视化你的太极程序</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/code/Taichi/Ch1.html#例子" class="sidebar-link reco-side-例子" data-v-b57cc07c>例子</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/docs/assets/js/app.eb0cdd49.js" defer></script><script src="/docs/assets/js/3.876e492f.js" defer></script><script src="/docs/assets/js/1.acc679c2.js" defer></script><script src="/docs/assets/js/20.87a29a2e.js" defer></script>
  </body>
</html>
